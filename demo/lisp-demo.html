<html>
    <head>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>Lisp Compiler in Java - Francis McNamee</title>
        <link rel="stylesheet" href="../css/style.css">
        <link rel="stylesheet" href="../css/lisp-demo.css">
    </head>
    <body>
        <div class="iframe-container">
            <h1 class="text-center demo-title">Handwritten Lisp Compiler in Java</h1>
            <hr>
            <h2>Project Highlights</h2>
		<ul>
			<li>Compiles to fast Java Bytecode using the ASM library</li>
		</ul>
        <hr />
		<h2>Overview</h2>
		<hr />
		<h2>Playground</h2>
        <hr />
		<h2>Example Code</h2>
		<div class="codeBlock">
			<span>Printing 'hello world' in the REPL. The print function returns nothing so the REPL returns nil after printing.</span>
			<!-- <code>
				> (print "hello world")<br />
				<strong>hello world</strong><br />
				<strong>nil</strong><br />
			</code> -->
            <div class="playground">
                <form>
                    <textarea placeholder="Type your code here ..." class="code" rows="1"/>(print "hello world")</textarea>
                    <div class="button" style="float: right;">
                        <input type="submit" class="run" value="Run code" />
                        <img class="loading" src="../images/loading2.gif">
                    </div>
                </form>
                <div class="result">
                    <pre></pre>
                </div>
            </div>
		</div>
		<div class="codeBlock">
			<span>Calling the builtin addition function.</span>
            <div class="playground">
                <form>
                    <textarea placeholder="Type your code here ..." class="code" rows="1"/>(+ 1 2 3 4 5)</textarea>
                    <div class="button" style="float: right;">
                        <input type="submit" class="run" value="Run code" />
                        <img class="loading" src="../images/loading2.gif">
                    </div>
                </form>
                <div class="result">
                    <pre></pre>
                </div>
            </div>
			<!-- <code>
				> (+ 1 2 3 4 5)<br />
				<strong>15</strong>
			</code> -->
		</div>
		<div class="codeBlock">
			<span>Creating a lambda (nameless function), assigning it to a symbol named 'inc' and calling the new 'inc' function.</span>
            <div class="playground">
                <form>
                    <textarea placeholder="Type your code here ..." class="code" rows="5"/>(def inc (lambda (x) (+ x 1)))

(inc 2)

(inc (inc 2))</textarea>
                    <div class="button" style="float: right;">
                        <input type="submit" class="run" value="Run code" />
                        <img class="loading" src="../images/loading2.gif">
                    </div>
                </form>
                <div class="result">
                    <pre></pre>
                </div>
            </div>
			<!-- <code>
				> (def inc (lambda (x) (+ x 1)))<br />
				> (inc 2)<br />
				<strong>3</strong><br />
				> (inc (inc 2))<br />
				<strong>4</strong><br />
			</code> -->
		</div>
		<div class="codeBlock">
			<span>Using the builtin 'type' function showing primitive types and custom Lisp-specific ones such as Cons and Symbol.</span>
            <div class="playground">
                <form>
                    <textarea placeholder="Type your code here ..." class="code" rows="9"/>(type 123)

(type "hello world")

(type 1.23)

(type (quote a))

(type '(1 2 3 4))</textarea>
                    <div class="button" style="float: right;">
                        <input type="submit" class="run" value="Run code" />
                        <img class="loading" src="../images/loading2.gif">
                    </div>
                </form>
                <div class="result">
                    <pre></pre>
                </div>
            </div>
			<!-- <code>
				> (type 123)<br />
				<strong>java.lang.Integer</strong><br />
				> (type "hello world")<br />
				<strong>java.lang.String</strong><br />
				> (type 1.23)<br />
				<strong>java.lang.Float</strong><br />
				> (type (quote a))<br />
				<strong>ie.francis.lisp.type.Symbol</strong><br />
				> (type (quote (1 2 3 4)))<br />
				<strong>ie.francis.lisp.type.Cons</strong>
			</code> -->
		</div>
        <div class="codeBlock">
			<span>Implementing the Fibonacci function and calculating fibonacci(20)</span>
            <div class="playground">
                <form>
                    <textarea placeholder="Type your code here ..." class="code" rows="4"/>(func fib (n) 
    (if (< n 2) n (+ (fib (- n 1)) (fib (- n 2)))))

(fib 20)</textarea>
                    <div class="button" style="float: right;">
                        <input type="submit" class="run" value="Run code" />
                        <img class="loading" src="../images/loading2.gif">
                    </div>
                </form>
                <div class="result">
                    <pre></pre>
                </div>
            </div>
		</div>
        </div>
        <script src="../js/iframe-resizer/iframe-resizer.child.js"></script>
		<script type="text/javascript">


            let playgrounds = document.getElementsByClassName("playground");
            for (let playground of playgrounds) {
                let form = playground.getElementsByTagName("form")[0];
                // Find submit button to run the code
                let button = form.getElementsByClassName("run")[0];
                // Find the loading image
                let loading = form.getElementsByClassName("loading")[0];
                // Find the run button for the playground
                let code = form.getElementsByClassName("code")[0];
                // Find the result div for the playground
                let result = playground.getElementsByClassName("result")[0];
                code.onkeyup = function (event) {
                    code.rows = code.value.split("\n").length;
                }
                button.onclick = function(event) {
                    event.preventDefault();
                    button.disabled = true;
                    button.value = "";
                    loading.style.display = "block";
                    fetch(`https://fsp-playground.francismcnamee.com/run`, {
					method: "post",
					body: JSON.stringify({ code: code.value}),
					headers: {
					    "Content-Type": "application/json",
  					},
				})
				.then(function(response) {
					if (!response.ok) {
						return Promise.reject(response)
					}
						return response.json();
				})
				.then(function(data) {
					result.style.display = "inline-block";
                    button.disabled = false;
                    button.value = "Run code";
                    loading.style.display = "none";
					if (Object.hasOwn(data, 'msg')) {
						result.getElementsByTagName("pre")[0].innerText = data.msg;
					}
				})
				.catch(function(error) {
					return error.json()
						.then(function(error) {
                            button.disabled = false;
                            button.value = "Run code";
                            loading.style.display = "none";
							result.style.display = "inline-block";
							result.getElementsByTagName("pre")[0].innerText = `${error.error}`;
						})
				})
                };

            }
		</script>
    </body>
</html>